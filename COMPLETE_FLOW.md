# ğŸ”„ Luá»“ng hoÃ n chá»‰nh: Chatbot tá»± há»c tá»« cÃ¢u há»i ngÆ°á»i dÃ¹ng

## âœ… **Luá»“ng SAU KHI Sá»¬A (HOÃ€N CHá»ˆNH):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. USER há»i chatbot qua giao diá»‡n web                      â”‚
â”‚    VÃ­ dá»¥: "ThÆ° viá»‡n má»Ÿ cá»­a máº¥y giá»?"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. chat.py xá»­ lÃ½ vÃ  tráº£ lá»i                                â”‚
â”‚    - TÃ¬m trong Qdrant (vector search)                      â”‚
â”‚    - Náº¿u khÃ´ng tÃ¬m tháº¥y â†’ Tráº£ lá»i: "ChÆ°a cÃ³ thÃ´ng tin"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. chat_fixed.py tá»± Ä‘á»™ng push lÃªn Notion                   â”‚
â”‚    (function: push_to_notion)                               â”‚
â”‚    - Question: "ThÆ° viá»‡n má»Ÿ cá»­a máº¥y giá»?"                  â”‚
â”‚    - Answer: "ChÆ°a cÃ³ thÃ´ng tin..."                         â”‚
â”‚    - Approved: âœ… (True) â† Tá»± Ä‘á»™ng tick                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Notion database "Faq_API" nháº­n record má»›i               â”‚
â”‚    â†’ Hiá»ƒn thá»‹ trong view (vÃ¬ Approved=âœ…)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Báº N vÃ o Notion vÃ  Sá»¬A cÃ¢u tráº£ lá»i                       â”‚
â”‚    - Question: "ThÆ° viá»‡n má»Ÿ cá»­a máº¥y giá»?" (giá»¯ nguyÃªn)    â”‚
â”‚    - Answer: "7h - 22h hÃ ng ngÃ y" â† Sá»¬A Láº I                â”‚
â”‚    - Approved: âœ… (váº«n tick)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. n8n workflow trigger (Notion â†’ Database trigger)        â”‚
â”‚    - PhÃ¡t hiá»‡n record Ä‘Æ°á»£c UPDATE                           â”‚
â”‚    - Kiá»ƒm tra: Approved = âœ…                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. n8n gá»­i POST request tá»›i:                                â”‚
â”‚    https://...ngrok.../notion/faq                           â”‚
â”‚    Body: {                                                  â”‚
â”‚      "notion_id": "...",                                    â”‚
â”‚      "question": "ThÆ° viá»‡n má»Ÿ cá»­a máº¥y giá»?",               â”‚
â”‚      "answer": "7h - 22h hÃ ng ngÃ y",                        â”‚
â”‚      "approved": 1                                          â”‚
â”‚    }                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. sync_n8n_to_sqlite.py nháº­n data                         â”‚
â”‚    - Ghi vÃ o faq.db (SQLite)                               â”‚
â”‚    - âœ… Tá»° Äá»˜NG cháº¡y push_to_qdrant.py (BACKGROUND)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. push_to_qdrant.py Ä‘á»c faq.db vÃ  push lÃªn Qdrant        â”‚
â”‚    - Táº¡o vector embedding cho cÃ¢u há»i                       â”‚
â”‚    - LÆ°u vÃ o Qdrant collection "faq"                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. âœ… HOÃ€N Táº¤T! Chatbot Ä‘Ã£ há»c cÃ¢u má»›i                   â”‚
â”‚     Láº§n sau user há»i "má»Ÿ cá»­a máº¥y giá»"                      â”‚
â”‚     â†’ Chatbot tráº£ lá»i: "7h - 22h hÃ ng ngÃ y"                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ **TÃ³m táº¯t:**

### **BÆ°á»›c tá»± Ä‘á»™ng (KHÃ”NG Cáº¦N CODE):**

1. âœ… User há»i â†’ Chatbot tráº£ lá»i
2. âœ… Chatbot tá»± Ä‘á»™ng push cÃ¢u há»i + cÃ¢u tráº£ lá»i lÃªn Notion
3. âœ… Notion hiá»ƒn thá»‹ record má»›i (Approved=âœ…)

### **BÆ°á»›c Báº N Cáº¦N LÃ€M (THAO TÃC TAY):**

4. ğŸ–Šï¸ **VÃ o Notion, sá»­a cÃ¢u tráº£ lá»i cho Ä‘Ãºng**
5. ğŸ–Šï¸ **Giá»¯ nguyÃªn tick Approved=âœ…**

### **BÆ°á»›c tá»± Ä‘á»™ng tiáº¿p (SAU KHI Báº N Sá»¬A):**

6. âœ… n8n phÃ¡t hiá»‡n record Ä‘Æ°á»£c update
7. âœ… n8n gá»­i data xuá»‘ng server
8. âœ… Server ghi vÃ o SQLite
9. âœ… **Tá»° Äá»˜NG** push lÃªn Qdrant (Má»šI THÃŠM!)
10. âœ… Chatbot há»c Ä‘Æ°á»£c cÃ¢u má»›i

---

## ğŸ“Š **Kiá»ƒm tra luá»“ng hoáº¡t Ä‘á»™ng:**

### **Test 1: Há»i cÃ¢u má»›i**
```
User: "Wifi thÆ° viá»‡n password lÃ  gÃ¬?"
Bot: "ChÆ°a cÃ³ thÃ´ng tin..."
â†’ Notion: Record má»›i xuáº¥t hiá»‡n
```

### **Test 2: Sá»­a cÃ¢u tráº£ lá»i**
```
Notion: Sá»­a Answer = "Password: library2024"
â†’ n8n trigger
â†’ Server nháº­n data
â†’ Push lÃªn Qdrant
â†’ âœ… Chatbot há»c Ä‘Æ°á»£c!
```

### **Test 3: Há»i láº¡i**
```
User: "Wifi thÆ° viá»‡n password lÃ  gÃ¬?"
Bot: "Password: library2024" â† âœ… ÄÃƒ Há»ŒC!
```

---

## âš ï¸ **LÆ°u Ã½ quan trá»ng:**

### **1. Ngrok pháº£i cháº¡y Ä‘Ãºng port:**
```bash
ngrok http 8000  # âœ… ÄÃšNG
```

### **2. Server pháº£i cháº¡y:**
```bash
uv run uvicorn chat_fixed:app --host 0.0.0.0 --port 8000 --workers 1
```

### **3. n8n workflow pháº£i:**
- âœ… Trigger khi Notion record UPDATE (khÃ´ng chá»‰ CREATE)
- âœ… Filter: Approved = âœ…
- âœ… Gá»­i Ä‘Ãºng format JSON
- âœ… URL Ä‘Ãºng: `https://...ngrok.../notion/faq`

### **4. Sau khi sá»­a Notion:**
- â±ï¸ Äá»£i 5-10 giÃ¢y Ä‘á»ƒ Qdrant sync xong
- ğŸ”„ Reload chatbot (náº¿u cáº§n)
- âœ… Test láº¡i cÃ¢u há»i

---

## ğŸ’¡ **Tip:**

Äá»ƒ kiá»ƒm tra Qdrant Ä‘Ã£ nháº­n data chÆ°a:

```python
# Má»Ÿ Python console
from qdrant_client import QdrantClient

client = QdrantClient(url="http://localhost:6333")
result = client.query_points(
    collection_name="faq",
    query_filter={"must": [{"key": "question", "match": {"value": "wifi"}}]},
    limit=5
)
print(result)
```

Hoáº·c má»Ÿ Qdrant dashboard:
```
http://localhost:6333/dashboard
```

---

## âœ… **Káº¿t luáº­n:**

**ÄÃšNG Rá»’I!** Báº¡n khÃ´ng cáº§n code gÃ¬ thÃªm. Chá»‰ cáº§n:

1. **Restart server** (Ä‘á»ƒ load code má»›i)
2. **Há»i chatbot** cÃ¢u má»›i
3. **VÃ o Notion sá»­a cÃ¢u tráº£ lá»i**
4. **Äá»£i vÃ i giÃ¢y** â†’ Chatbot tá»± há»c!

ğŸ‰ **HoÃ n toÃ n tá»± Ä‘á»™ng!**
